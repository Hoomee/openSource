function resourceCallBack(){cc.game.onStart=function(){cc.view.adjustViewPort(!0),thisismobile?cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.EXACT_FIT):cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.SHOW_ALL),cc.view.resizeWithBrowserSize(!0),MyLoaderScene.preload(g_resources,function(){cc.director.runScene(new ruleScene)},this)},cc.game.run("gameCanvas")}function getRandom(a){return Math.floor(Math.random()*a)%a}function randomArr(){for(var a=1,b=0,c=[],d=0;d<8;d++){a=1,b=parseInt(8*Math.random()+1);for(var e=0;e<d;e++)c[e]==b&&(a=0,d--);1==a&&c.push(b)}return c}var global_game_start=!1,myscroll1=new IScroll("#rule_wrapper",{click:!0}),myscroll2=new IScroll("#phb_wrapper",{click:!0});!function(){TOOL.closeFun(".prize_close_btn",".prizePage"),TOOL.closeFun(".rule_close_btn",".rulePage",function(){console.log("here")}),TOOL.closeFun(".phb_close_btn",".phbPage"),TOOL.closeFun(".info_close_btn",".infoPage",function(){console.log("heree")}),TOOL.closeFun(".beginBtn",".beginPage",function(){global_game_start=!0}),TOOL.closeFun(".rule_btn","",function(){TOOL.showDialog(".rulePage","fadeInDown",function(){$(".rulePage").removeClass("animated fadeInDown"),myscroll1.refresh()})}),TOOL.closeFun(".record_btn","",function(){system.isUserInfo?GD.rankingList(1,function(a){var b=a.code;switch(b){case 0:TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()}),$(".phbContent ul").append("获取失败！"),$(".phbContent ul").css({width:"150px",height:"100px","font-size":"26px",position:"absolute",top:"20px",left:"200px"});break;case 1:TOOL.createPhbData(a),TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()});break;case 2:TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()}),$(".phbContent ul").append("暂无数据！"),$(".phbContent ul").css({width:"150px",height:"100px","font-size":"26px",position:"absolute",top:"20px",left:"200px"})}}):($(".phbPage").removeClass("hide"),TOOL.showDialog(".phbPage","bounceInDown",function(){}))}),TOOL.closeFun(".playAgain",".endPage",function(){game.resetGame();new BeginScene;cc.director.runScene(new BeginScene)}),TOOL.closeFun(".seeMore","",function(){$(".sharePage").removeClass("hide")}),TOOL.closeFun(".lottery",".endPage",function(){game.resetGame();new BeginScene;cc.director.runScene(new BeginScene)}),TOOL.closeFun(".sharePage",".sharePage",function(){$(".sharePage").addClass("hide")}),$(".info_send_btn").off().on("touchstart",function(){var a=$(".user_name").val(),b=$(".user_phone").val();GD.userInfo(a,b,function(a){var b=a.code;switch(b){case 0:TOOL.showDialog(".alertPage","fadeInDown",function(){$(".alertPage").removeClass("animated fadeInDown")}),$(".alertContent").html("网络出错！");break;case 1:system.isUserInfo=!0,$(".infoPage").addClass("hide"),GD.rankingList(1,function(a){var b=a.code;switch(b){case 0:TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()}),$(".phbContent ul").append("获取失败！"),$(".phbContent ul").css({width:"150px",height:"100px","font-size":"26px",position:"absolute",top:"20px",left:"200px"});break;case 1:TOOL.createPhbData(a),TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()});break;case 2:TOOL.showDialog(".phbPage","bounceIn",function(){$(".phbPage").removeClass("animated bounceIn"),myscroll2.refresh()}),$(".phbContent ul").append("暂无数据！"),$(".phbContent ul").css({width:"150px",height:"100px","font-size":"26px",position:"absolute",top:"20px",left:"200px"})}})}})})}(),window.onload=function(){TOOL.loading(1500),resourceCallBack(),TOOL.media({musicSrc:"../../static/common/vo/bg_music.mp3",musicPlaySrc:"/html/static/flybird/res/img/mPlay.png",musicPauseSrc:"/html/static/flybird/res/img/mPaused.png"})};var MyLoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"MyLoaderScene",init:function(){var a=this,b=a._bgLayer=cc.LayerColor.create(cc.color(32,32,32,255));b.setPosition(cc.visibleRect.bottomLeft),a.addChild(b,0);var c=24,d=cc.director.getWinSize(),e=cc.Sprite.create(res.loadingPage);e.setPosition(d.width/2,d.height/2),e.setScale(1),b.addChild(e,0);var f=a._label=cc.LabelTTF.create("Loading... 0%","Arial",c);return f.setPosition(d.width/2,d.height/2-200),f.setColor(cc.color(255,255,255)),b.addChild(this._label,10),!0},_initStage:function(a,b){var c=this,d=c._texture2d=new cc.Texture2D;d.initWithElement(a),d.handleLoadedTexture();var e=c._logo=cc.Sprite.create(d);e.setScale(cc.contentScaleFactor()),e.x=b.x,e.y=b.y,c._bgLayer.addChild(e,10)},onEnter:function(){var a=this;cc.Node.prototype.onEnter.call(a),a.schedule(a._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var a="Loading... 100%";this._label.setString(a)},initWithResources:function(a,b){"string"==typeof a&&(a=[a]),this.resources=a||[],this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;cc.loader.load(b,function(b,c,d){var e=d/c*100|0;e=Math.min(e,100),a._label.setString("Loading... "+e+"%")},function(){a.cb&&a.cb()})},_updatePercent:function(){var a=this,b=a._count,c=a._length,d=b/c*100|0;d=Math.min(d,100),a._label.setString("Loading... "+d+"%"),b>=c&&a.unschedule(a._updatePercent)}});MyLoaderScene.preload=function(a,b){var c=null;return c||(c=new MyLoaderScene,c.init()),c.initWithResources(a,b),cc.director.runScene(c),c};var thisismobile=!1;thisismobile=!(!/AppleWebKit.*Mobile/i.test(navigator.userAgent)&&!/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent));var size={width:640,height:1024},k_Acceleration=2,globalSpr=null,ruleScene=cc.Scene.extend({ctor:function(){this._super();var a=new cc.Sprite(res.ruleBg);a.x=size.width/2,a.y=size.height/2,this.addChild(a);var b=new cc.MenuItemImage(res.knowBtn,res.knowBtn,this.knowBtnCall,this),c=new cc.Menu(b);c.x=size.width/2,c.y=size.height/2-250,this.addChild(c)},knowBtnCall:function(){global_game_start&&(global_game_start=!1,cc.director.runScene(new gameScene))}}),gameScene=cc.Scene.extend({PipeSpriteList:[],m_DeltaY:0,m_startPosition:null,m_targetPosition:null,tick:0,passTime:0,gameEnd:!1,noHitArr:[],scoreLabel:null,acrossCheck:!1,scoreNum:0,ctor:function(){this._super(),this.m_startPosition=cc.p(0,0),this.m_targetPosition=cc.p(0,0),this.init(),this.gameEnd=!1,this.scoreNum=0,this.PipeSpriteList=[],this.noHitArr.length=0,this.loadListener()},init:function(){var a=new cc.Sprite(res.bg);a.x=size.width/2,a.y=size.height/2,this.addChild(a),this.bottomBg=new cc.Sprite(res.bottomBg),this.bottomBg.anchorY=0,this.bottomBg.x=size.width/2,this.bottomBg.y=0,this.addChild(this.bottomBg,100),this.bus=new cc.Sprite(res.bus),this.bus.x=100,this.bus.y=200,this.addChild(this.bus,1e3),this.car=new cc.Sprite(res.car),this.car.x=size.width-100,this.car.y=200,this.addChild(this.car,1e3);var b=new cc.moveBy(.1,cc.p(0,3)),c=b.reverse(),d=cc.sequence(b,c),e=new cc.RepeatForever(d);this.bus.runAction(e),this.car.runAction(e.clone()),this.scoreLabel=new cc.LabelTTF("0","Arial",64),this.scoreLabel.x=size.width/2,this.scoreLabel.y=size.height-80,this.scoreLabel.fillStyle=cc.color(238,10,0),this.addChild(this.scoreLabel,1e4),this.initBird(),this.initLoopBg(),this.scheduleUpdate()},initLoopBg:function(){this.bg=new Background(res.beiying,1),this.bg.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg),this.bg1=new Background(res.beiying,1),this.bg1.xx=640,this.bg1.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg1),this.bg2=new Background(res.cloud,1),this.bg2.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg2),this.bg3=new Background(res.cloud,1),this.bg3.xx=640,this.bg3.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg3),this.bg4=new Background(res.moveBg,3),this.bg4.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg4),this.bg5=new Background(res.moveBg,3),this.bg5.xx=1919,this.bg5.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg5),this.bg6=new Background(res.road,2),this.bg6.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg6,100),this.bg7=new Background(res.road,2),this.bg7.xx=640,this.bg7.attr({x:0,y:0,anchorX:0,anchorY:0}),this.addChild(this.bg7,100)},update:function(){this.bg.update(225,-640,0),this.bg1.update(225,0,640),this.bg2.update(750,-640,0),this.bg3.update(750,0,640),this.bg4.update(225,-1919,0),this.bg5.update(225,0,1919),this.bg6.update(171,-640,0),this.bg7.update(171,0,640);for(var a=0;a<this.PipeSpriteList.length;++a){var b=this.PipeSpriteList[a];b.setPositionX(b.getPositionX()-3),b.getPositionX()<-b.getContentSize().width/2&&(this.PipeSpriteList.splice(a,1),this.acrossCheck=!1),b.getPositionX()<230&&b.getPositionX()>227&&(this.noHitArr.push(0),this.scoreNum=Math.floor(this.noHitArr.length/2),this.scoreLabel.setString(this.scoreNum))}this.passTime+=1,this.passTime>=size.width/4&&(this.addPipe(),this.passTime=0),this.checkCollision()},initBird:function(){var a=cc.textureCache.addImage(res.ani),b=[];b[0]=new cc.SpriteFrame(a,cc.rect(0,0,141,84)),b[1]=new cc.SpriteFrame(a,cc.rect(141,0,141,84)),b[2]=new cc.SpriteFrame(a,cc.rect(282,0,141,84)),b[3]=new cc.SpriteFrame(a,cc.rect(423,0,141,84));var c=new cc.Animation(b,.3),d=new cc.animate(c);cc.animationCache.addAnimation(c,"FlyBirdAnimation"),globalSpr=this.flyBird=new cc.Sprite(res.ani1),this.flyBird.x=size.width/2,this.flyBird.y=size.height/2,this.addChild(this.flyBird,1e3);var e=new cc.repeatForever(d);this.flyBird.runAction(e)},runBirdAction:function(){var a=50,b=this.flyBird.getPositionX(),c=this.flyBird.getPositionY(),d=80,e=new cc.animate(cc.animationCache.getAnimation("FlyBirdAnimation")),f=new cc.repeatForever(e),g=cc.MoveTo.create(.2,cc.p(b,c+a)),h=cc.RotateTo.create(0,-30),i=cc.Spawn.create(g,h),j=FreeFall.create(c-d),k=cc.RotateTo.create(0,30),l=new cc.Spawn(j,k);this.flyBird.stopAllActions(),this.flyBird.runAction(f),this.flyBird.runAction(new cc.Spawn(new cc.sequence(i,l)))},addPipe:function(){var a=(parseInt(8*Math.random()),res.up),b=res.down,c=new cc.Sprite(b),d=c.getContentSize().height,e=c.getContentSize().width,f=250,g=300,h=100+getRandom(400),i=size.height-h-g-f,j=size.width+e/2;c.x=j+e/2,c.y=f+d/2-(d-h);var k=new cc.Sprite(a);k.x=j+e/2,k.y=size.height+(d-i)-d/2,this.addChild(c,98),this.addChild(k,98),this.PipeSpriteList.push(c),this.PipeSpriteList.push(k)},getRect:function(a){var b=a.getPosition(),c=a.getContentSize();return cc.rect(b.x-c.width/2,b.y-c.height/2,c.width,c.height)},collide:function(a,b){var c=this.getRect(a),d=this.getRect(b);return cc.rectIntersectsRect(c,d)},checkCollision:function(){if(this.collide(this.flyBird,this.bottomBg))return void this.birdFallAction();for(var a=0;a<this.PipeSpriteList.length;a++){var b=this.PipeSpriteList[a];if(this.collide(this.flyBird,b)){this.birdFallAction();break}}},birdFallAction:function(){this.flyBird.stopAllActions();var a=(this.flyBird.getPositionX(),this.flyBird.getPositionY()),b=50,c=FreeFall.create(a-b),d=new cc.RotateTo(0,180),e=new cc.Spawn(c,d);this.flyBird.runAction(new cc.sequence(new cc.delayTime(.1),e)),this.runAction(new cc.sequence(new cc.delayTime(.1),new cc.callFunc(this.gameOver,this)))},gameOver:function(){if(!this.gameEnd){this.gameEnd=!0,this.car.stopAllActions(),this.bus.stopAllActions(),this.unscheduleUpdate(),$(".middlePage").removeClass("hide"),this.removeAllChildrenWithCleanup();var a=this.scoreNum;GD.doingGame(a,function(){$(".middlePage").addClass("hide"),$(".endPage").removeClass("hide")});var b=0;b=0==a?0:a<40?parseInt(20*Math.random()+50):a<60?parseInt(20*Math.random()+70):parseInt(9*Math.random()+90)}},loadListener:function(){var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,target:this,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchMoved:this.onTouchMoved,onTouchEnded:this.onTouchEnded});cc.eventManager.addListener(a,this)},onTouchBegan:function(a,b){var c=this.target,d=c.convertToNodeSpace(a.getLocation()),e=c.getContentSize(),f=cc.rect(0,0,e.width,e.height);return!!cc.rectContainsPoint(f,d)},onTouchMoved:function(a,b){this.target},onTouchEnded:function(a,b){var c=this.target;c.gameEnd||c.runBirdAction()}}),FreeFall=cc.ActionInterval.extend({timeElasped:0,m_positionDeltaY:null,m_startPosition:null,m_targetPosition:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this.yOffsetElasped=0,this.timeElasped=0,this.m_positionDeltaY=0,this.m_startPosition=cc.p(0,0),this.m_targetPosition=cc.p(0,0)},initWithDuration:function(a){return!!cc.ActionInterval.prototype.initWithDuration.call(this,a)},initWithOffset:function(a){var b=.1*Math.sqrt(2*Math.abs(a)/k_Acceleration);return this.initWithDuration(b)?(this.m_positionDeltaY=a,!0):(cc.log("dropTime ="+b+"; deltaPosition="+a),!1)},isDone:function(){return this.m_targetPosition.y>=this._target.getPositionY()},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a),this.m_startPosition=a.getPosition(),this.m_targetPosition=cc.p(this.m_startPosition.x,this.m_startPosition.y-this.m_positionDeltaY)},update:function(a){if(this.timeElasped+=a,globalSpr&&!(this.m_targetPosition.y>=globalSpr.getPositionY())){var b=.5*k_Acceleration*this.timeElasped*this.timeElasped*.3;if(cc.ENABLE_STACKABLE_ACTIONS){var c=cc.p(this.m_startPosition.x,this.m_startPosition.y-b);this.m_targetPosition.y>c.y&&(c.y=this.m_targetPosition.y,globalSpr.stopAction(this)),globalSpr.setPosition(c)}else globalSpr.setPosition(cc.p(this.m_startPosition.x,this.m_startPosition.y+this.m_positionDeltaY*a))}}});FreeFall.create=function(a){var b=new FreeFall;return b.initWithOffset(a),b};var Background=cc.Sprite.extend({yy:0,xx:0,ctor:function(a,b){this._super(),this.initWithFile(a),this.tick=b},update:function(a,b,c){this.xx-=this.tick,this.yy=a,this.xx<b&&(this.xx=c),this.setPosition(this.xx,this.yy)}});